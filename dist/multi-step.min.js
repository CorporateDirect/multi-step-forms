!function(){class e{constructor(e,o={}){if(!(e instanceof HTMLFormElement))throw new Error("FormManager expects a form element");this.form=e,this.currentStep=0,this.history=[0],this.options=Object.assign({progress:!0},o),this.stepManager=new s(this.form),this.navigation=new t(this.stepManager),this.conditionalLogic=new a(this.stepManager),this.memory=new r(this.form,this.stepManager),this.validation=new n(this.form),this.attachGlobalListeners(),this.form.addEventListener("editField",e=>{const{fieldName:t}=e.detail;this.editField(t)}),this.editContext=null;const l=this.form.querySelector('[data-form="summary"]');l&&(this.summary=new i(this.stepManager,this.memory,l),this.summary.update()),this.navigation.handleNext=()=>{const e=this.stepManager.steps[this.currentStep].element;this.validation.validateStep(e)?this.nextStep():this.navigation.triggerErrorShake&&this.navigation.triggerErrorShake()},this.navigation.handlePrevious=()=>{this.previousStep()},this.options.progress&&this._initProgressBar()}_initProgressBar(){this.progressContainer=document.createElement("div"),this.progressContainer.className="progress-container",this.progressBar=document.createElement("div"),this.progressBar.className="progress-bar",this.progressContainer.appendChild(this.progressBar),this.form.prepend(this.progressContainer),this._updateProgressBar()}_updateProgressBar(){this.progressBar&&(this.progressBar.style.width=this.getProgressPercent()+"%")}getProgressPercent(){const e=this.stepManager.steps.length;return Math.round((this.currentStep+1)/e*100)}init(){this.stepManager.discoverSteps(),this.goToStep(0)}goToStep(e){const t=this.currentStep,s=this.stepManager.steps.length;if(e<0||e>=s)return;console.log(`FormManager: navigating from step ${this.currentStep} to step ${e}`),this.currentStep=e;this.history[this.history.length-1]!==e&&this.history.push(e),this.stepManager.showStep(e),this.navigation.currentIndex=e,this.navigation.updateButtonVisibility(),this.progressBar&&this._updateProgressBar(),this.summary&&t!==e&&this.summary.update(),t!==e&&(o(this.form),this._removeEditBar());const n=new CustomEvent("stepChange",{detail:{currentStep:e,totalSteps:this.stepManager.steps.length}});if(this.form.dispatchEvent(n),e===this.stepManager.steps.length-1&&t===e){const e=new Event("formComplete");this.form.dispatchEvent(e)}}nextStep(){console.log("FormManager: nextStep() called"),this.goToStep(this.currentStep+1)}previousStep(){console.log("FormManager: previousStep() called"),this.goToStep(this.currentStep-1)}getCurrentStep(){return this.stepManager.steps[this.currentStep]||null}editField(e){if(!this.summary)return;const t=this.summary.getFieldLocation(e);t&&(this.editContext={fieldName:e},null!==t.wrapperAnswer&&(this.stepManager.selectedAnswer=t.wrapperAnswer),this.goToStep(t.stepIndex),setTimeout(()=>{const t=this.form.querySelector(`[name="${e}"]`);t&&(l(t),this._showEditBar(t)),this.editContext=null},100))}_showEditBar(e){this.editBar&&this._removeEditBar();const t=e.placeholder||e.dataset.label||e.name;console.log(`Edit mode started for field "${e.name}"`);const s=document.createElement("div");s.className="edit-mode-bar",s.innerHTML=`<span>Editing: <strong>${t}</strong></span>`;const n=document.createElement("button");n.type="button",n.className="save-return-btn",n.textContent="Save & Return to Summary",s.appendChild(n);const a=document.createElement("button");a.type="button",a.className="cancel-edit-btn",a.textContent="Cancel",s.appendChild(a);(e.closest("[data-answer]")||e.parentElement).prepend(s);const r=()=>{this.validation.validateField(e)?(console.log(`Field "${e.name}" validated, saving and returning to summary`),this.memory.saveAllFields(),s.classList.add("success"),this.summary&&this.summary.update(),setTimeout(()=>{this._navigateToSummary(),this._removeEditBar()},600)):(console.log(`Validation failed for field "${e.name}"`),s.classList.add("shake"),setTimeout(()=>s.classList.remove("shake"),400))};n.addEventListener("click",e=>{e.preventDefault(),r()}),a.addEventListener("click",t=>{t.preventDefault(),console.log(`Edit canceled for field "${e.name}"`),this._removeEditBar(),this._navigateToSummary()});const i=e=>{"Enter"===e.key?(e.preventDefault(),r()):"Escape"===e.key&&(e.preventDefault(),this._removeEditBar(),this._navigateToSummary())};e.addEventListener("keydown",i),s.dataset.cleanup="true",s._cleanup=()=>{e.removeEventListener("keydown",i)},this.editBar=s}_removeEditBar(){this.editBar&&(console.log("Edit bar removed"),this.editBar._cleanup&&this.editBar._cleanup(),this.editBar.remove(),this.editBar=null,o(this.form))}_navigateToSummary(){const e=this.summary?this.summary.stepManager.steps.length-1:this.stepManager.steps.length-1;this.goToStep(e)}attachGlobalListeners(){this._globalListenersAttached||(this._globalListenersAttached=!0,document.addEventListener("click",e=>{const t=document.querySelector(".field-editing");t&&!t.contains(e.target)&&o(document)}),this.form.addEventListener("submit",()=>{o(this.form)}))}}document.addEventListener("DOMContentLoaded",()=>{});class t{constructor(e){this.stepManager=e,this.stepManager.steps&&this.stepManager.steps.length||this.stepManager.discoverSteps(),this.currentIndex=0,this.form=this.stepManager.root,this.createButtons(),this.attachListeners(),this.updateButtonVisibility()}createButtons(){this.navContainer=this.form.querySelector(".form-navigation"),this.navContainer||(this.navContainer=document.createElement("div"),this.navContainer.className="form-navigation",this.form.appendChild(this.navContainer)),this.prevButton=this.navContainer.querySelector('[data-nav="prev"]'),this.prevButton||(this.prevButton=document.createElement("button"),this.prevButton.type="button",this.prevButton.setAttribute("data-nav","prev"),this.prevButton.textContent="Previous",this.navContainer.appendChild(this.prevButton)),this.nextButton=this.navContainer.querySelector('[data-nav="next"]'),this.nextButton||(this.nextButton=document.createElement("button"),this.nextButton.type="button",this.nextButton.setAttribute("data-nav","next"),this.nextButton.textContent="Next",this.navContainer.appendChild(this.nextButton))}attachListeners(){this.nextButton.addEventListener("click",e=>{console.log("Navigation: Next button clicked");const t=this.stepManager.steps.length-1;this.currentIndex<t&&(e.preventDefault(),this.handleNext())}),this.prevButton.addEventListener("click",e=>{console.log("Navigation: Previous button clicked"),this.currentIndex>0&&(e.preventDefault(),this.handlePrevious())}),this.form.addEventListener("click",e=>{const t=e.target.closest("[data-form]");if(!t)return;const s=t.getAttribute("data-form");"next-btn"===s?(e.preventDefault(),this.handleNext()):"back-btn"===s&&(e.preventDefault(),this.handlePrevious());const n=t.getAttribute("data-skip-to");if(n){e.preventDefault();const t=this.stepManager.steps.findIndex(e=>e.element.id===n||e.element.dataset.stepName===n);t>=0&&(this.currentIndex=t,this.stepManager.showStep(t),this.updateButtonVisibility())}})}handleNext(){const e=this.currentIndex+1;e<this.stepManager.steps.length&&(this.currentIndex=e,this.stepManager.showStep(this.currentIndex),this.updateButtonVisibility())}handlePrevious(){const e=this.currentIndex-1;e>=0&&(this.currentIndex=e,this.stepManager.showStep(this.currentIndex),this.updateButtonVisibility())}updateButtonVisibility(){const e=this.stepManager.steps.length-1;this.prevButton.style.display=0===this.currentIndex?"none":"inline-block",this.currentIndex===e?(this.nextButton.textContent="Submit",this.nextButton.type="submit"):(this.nextButton.textContent="Next",this.nextButton.type="button")}triggerErrorShake(){this.navContainer&&(this.navContainer.classList.add("shake"),setTimeout(()=>{this.navContainer.classList.remove("shake")},500))}}class s{constructor(e=document){this.root=e,this.steps=[],this.selectedAnswer=""}discoverSteps(){const e=this.root.querySelectorAll('[data-form="step"]');return this.steps=Array.from(e).map((e,t)=>{const s=e.querySelectorAll("[data-answer]");return{element:e,index:t,wrappers:Array.from(s).map(e=>({element:e,answer:e.getAttribute("data-answer")}))}}),this.steps}hideAllSteps(){this.steps.length||this.discoverSteps(),this.steps.forEach(e=>{e.element.style.display="none"})}showStep(e){this.steps.length||this.discoverSteps(),this.steps.forEach(t=>{t.element.style.display=t.index===e?"block":"none"});const t=this.steps[e];if(t){const s=0===e?"":this.selectedAnswer||"";this.showWrapper(t,s)}}showWrapper(e,t=""){if(!e||!e.wrappers)return;let s=!1;e.wrappers.forEach(e=>{const n=(e.answer||"")===t;e.element.style.display=n?"block":"none",n&&(s=!0)}),!s&&e.wrappers.length&&(e.wrappers[0].element.style.display="block")}}class n{constructor(e){this.form=e}validateStep(e){if(!e)return!0;if(e.hasAttribute("data-form-no-input"))return!0;this.clearErrors(e);let t=!0;return e.querySelectorAll("[required]").forEach(e=>{this.validateField(e)||(t=!1)}),t}validateField(e){if(!(e instanceof HTMLInputElement||e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement))return!0;const t=e.type,s=e.name;let n=!0;if("radio"===t){const t=e.closest('[data-form="step"]').querySelectorAll(`input[type="radio"][name="${s}"]`);n=Array.from(t).some(e=>e.checked)}else if("checkbox"===t){n=e.checked}else n=""!==e.value.trim();return n||this.showError(e,"This field is required"),n}showError(e,t){e.classList.add("field-error");let s=e.parentElement.querySelector(".error-message");s||(s=document.createElement("div"),s.className="error-message",e.parentElement.appendChild(s)),s.textContent=t}clearErrors(e){e&&(e.querySelectorAll(".field-error").forEach(e=>e.classList.remove("field-error")),e.querySelectorAll(".error-message").forEach(e=>e.remove()))}}class a{constructor(e){this.stepManager=e,this.form=e.root,this.attachListeners()}attachListeners(){this.form.querySelectorAll('input[type="radio"][data-go-to]').forEach(e=>{e.addEventListener("change",()=>{if(e.checked){const t=e.dataset.goTo||"";console.log(`ConditionalLogic: selected answer value "${t}"`),this.stepManager.selectedAnswer=t}})})}}class r{constructor(e,t,s=500){this.form=e,this.stepManager=t,this.debounceMs=s,this.storageKey=`form-memory-${e.id||"default"}`,this.data=this._loadFromStorage(),this._saveTimeout=null,this.attachListeners(),this.restoreValues()}attachListeners(){this.form.addEventListener("change",e=>{const t=e.target;t.name&&this._saveFromElement(t)}),this.form.addEventListener("input",e=>{const t=e.target;t.name&&("textarea"!==t.tagName.toLowerCase()&&"text"!==t.type&&"email"!==t.type&&"number"!==t.type&&"url"!==t.type&&"tel"!==t.type||this._saveFromElement(t))})}saveField(e,t,s={}){e&&(this.data.values||(this.data.values={}),this.data.values[e]={value:t,timestamp:Date.now(),...s},this._debouncedPersist())}saveAllFields(){const e=this.form.elements;Array.from(e).forEach(e=>{(e instanceof HTMLInputElement||e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement)&&e.name&&this._saveFromElement(e)}),this._persistToStorage()}getAllValues(){const e={};return Object.keys(this.data.values||{}).forEach(t=>{e[t]=this.data.values[t].value}),e}clear(){localStorage.removeItem(this.storageKey),this.data={values:{},lastUpdated:Date.now()}}restoreValues(){const e=this.data.values||{};Object.keys(e).forEach(t=>{const s=e[t],n=s.fieldType,a=this.form.querySelectorAll(`[name="${t}"]`);if(a.length)if("checkbox"===n){const e=Array.isArray(s.value)?s.value:[];a.forEach(t=>{t instanceof HTMLInputElement&&(t.checked=e.includes(t.value))})}else if("radio"===n)a.forEach(e=>{e instanceof HTMLInputElement&&(e.checked=e.value===s.value,e.checked&&e.dispatchEvent(new Event("change")))});else if("select"===n){const e=a[0];Array.isArray(s.value)?Array.from(e.options).forEach(e=>{e.selected=s.value.includes(e.value)}):e.value=s.value,e.dispatchEvent(new Event("change"))}else{const e=a[0];e.value=s.value,e.dispatchEvent(new Event("input"))}})}_getFieldType(e){return e instanceof HTMLSelectElement?"select":e instanceof HTMLTextAreaElement?"textarea":"checkbox"===e.type?"checkbox":"radio"===e.type?"radio":"text"}_getStepIndex(e){if(!this.stepManager)return-1;const t=e.closest('[data-form="step"]');if(!t)return-1;const s=this.stepManager.steps.find(e=>e.element===t);return s?s.index:-1}_isElementVisible(e){return!(null===e.offsetParent)}_saveFromElement(e){if(!e||!e.name)return;const t=e.name,s=this._getFieldType(e),n=this._getStepIndex(e),a=this._isElementVisible(e);let r;if("checkbox"===s){const e=this.form.querySelectorAll(`input[type="checkbox"][name="${t}"]`);r=Array.from(e).filter(e=>e.checked).map(e=>e.value)}else if("radio"===s)r=e.checked?e.value:this.data.values?.[t]?.value||"";else if("select"===s){const t=e;r=t.multiple?Array.from(t.selectedOptions).map(e=>e.value):t.value}else r=e.value;this.saveField(t,r,{stepIndex:n,fieldType:s,isVisible:a})}_loadFromStorage(){try{const e=localStorage.getItem(this.storageKey);if(e)return JSON.parse(e)}catch(e){console.warn("Memory: failed to parse stored data",e)}return{values:{},lastUpdated:Date.now()}}_debouncedPersist(){this._saveTimeout&&clearTimeout(this._saveTimeout),this._saveTimeout=setTimeout(()=>{this._persistToStorage()},this.debounceMs)}_persistToStorage(){this.data.lastUpdated=Date.now();try{localStorage.setItem(this.storageKey,JSON.stringify(this.data)),console.log("Memory: data persisted",this.data)}catch(e){console.warn("Memory: failed to save data",e)}}}class i{constructor(e,t,s){this.stepManager=e,this.memory=t,this.container=s}generate(){const e=[],t=this.memory.data.values||{};return Object.keys(t).forEach(s=>{const n=t[s];if(!n.isVisible)return;const a=n.stepIndex??-1,r=this.stepManager.steps[a];let i=`Step ${a+1}`;if(r)if(r.element.dataset.stepName)i=r.element.dataset.stepName;else{const e=r.element.querySelector("h2,h3");e&&e.textContent&&(i=e.textContent.trim())}let o=e.find(e=>e.index===a);o||(o={index:a,name:i,items:[]},e.push(o));const l=this._getFieldLabel(s);o.items.push({label:l,value:n.value,fieldName:s})}),e.sort((e,t)=>e.index-t.index),e}render(e=this.container){if(!e)return;const t=this.generate();e.innerHTML="",t.forEach(t=>{const s=document.createElement("div");s.className="summary-group";const n=document.createElement("h3");n.textContent=t.name,s.appendChild(n),t.items.forEach(e=>{const n=document.createElement("div");n.className="summary-item",n.dataset.fieldName=e.fieldName,n.dataset.stepIndex=t.index,n.style.cursor="pointer";const a=document.createElement("span");a.className="label",a.textContent=e.label;const r=document.createElement("span");r.className="value",Array.isArray(e.value)?r.textContent=e.value.join(", "):r.textContent=e.value;const i=document.createElement("span");i.className="edit-icon",i.textContent="✏️",n.appendChild(a),n.appendChild(r),n.appendChild(i),s.appendChild(n)}),e.appendChild(s)}),this.attachEditHandlers()}attachEditHandlers(){this.container.querySelectorAll(".summary-item").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.fieldName,s=parseInt(e.dataset.stepIndex,10);this.initiateFieldEdit(t,s)})})}initiateFieldEdit(e,t){this.editContext={fieldName:e,stepIndex:t};const s=new CustomEvent("editField",{detail:{fieldName:e}});this.stepManager.root.dispatchEvent(s)}getFieldLocation(e){const t=this.stepManager.root.querySelector(`[name="${e}"]`);if(!t)return null;const s=t.closest('[data-form="step"]');if(!s)return null;const n=this.stepManager.steps.find(e=>e.element===s),a=n?n.index:-1,r=t.closest("[data-answer]");return{stepIndex:a,wrapperAnswer:r?r.getAttribute("data-answer"):null}}update(){this.render()}_getFieldLabel(e){const t=this.stepManager.root.querySelector(`[name="${e}"]`);if(t){if(t.dataset.label)return t.dataset.label;if(t.placeholder)return t.placeholder;const e=t.closest("label");if(e){const t=e.cloneNode(!0);t.querySelectorAll("input,select,textarea").forEach(e=>e.remove());const s=t.textContent?.trim();if(s)return s}if(t.id){const e=this.stepManager.root.querySelector(`label[for="${t.id}"]`);if(e)return e.textContent?.trim()}}return e}}if(console.log("Multi-step form script loaded"),"undefined"!=typeof document){const t=()=>{document.querySelectorAll('[data-form="multistep"]').forEach(t=>{const s=new e(t);t.__formManager=s,s.init(),console.log("FormManager initialized:",s)})};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t):t()}function o(e=document){e.querySelectorAll(".field-editing").forEach(e=>e.classList.remove("field-editing"))}function l(e,t=100){if(!e)return;o(e.ownerDocument),e.classList.add("field-editing");try{e.focus({preventScroll:!0})}catch{e.focus()}const s=e.getBoundingClientRect().top+window.scrollY-t;window.scrollTo({top:s,behavior:"smooth"})}"undefined"!=typeof window&&(window.FieldHighlight={highlightField:l,clearHighlight:o})}();